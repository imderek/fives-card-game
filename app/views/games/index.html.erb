<%= turbo_stream_from "games" %>
<%= turbo_stream_from "user_#{current_user.id}_games" %>

<div class="max-w-7xl mx-auto p-4 pt-0">
  <!-- Welcome -->
  <div class="mb-4 text-center text-white py-1">
    <h2 class="text-xl font-medium mb-3.5">Welcome, <%= current_user.email.titleize %>.</h2>
    <div class="flex flex-col justify-center gap-4">
      <!-- Play buttons -->
      <div class="flex flex-row items-stretch justify-center gap-2.5">
        <!-- Play a friend -->
        <a href="<%= new_game_path(type: :pvp) %>" class="text-[.925rem] overflow-hidden relative flex flex-col justify-center px-2 py-[0.8rem] pt-[1rem] btn btn-primary">
          <div class="absolute -left-7 top-2.5 bg-gradient-to-r from-amber-500 to-amber-600 text-[0.7rem] text-white px-8 py-0.5 -rotate-45 leading-[16.8px]">NEW</div>
          <div class="flex justify-center text-lg -space-x-0.5">
            <i class="mb-1.5 fa-solid fa-user"></i>
            <i class="mb-1.5 fa-regular fa-user"></i>
          </div>
          Play a Friend
        </a>
        <!-- Play solo -->
        <a href="<%= new_game_path(type: :bot) %>" class="text-[.925rem] px-2 py-[0.8rem] pt-[1rem] btn btn-secondary">
          <div class="flex justify-center text-lg -space-x-1">
            <i class="mb-1.5 fa-solid fa-play"></i>
          </div>
          Play Solo
        </a>
      </div>
    </div>
  </div>

  <!-- Top scores -->
  <h1 class="text-xl font-medium mb-3 dark:text-white">Leaderboard</h1>
  <div class="grid gap-4 mb-5">
    <div class="text-sm flex flex-col gap-3 justify-between text-white p-4 bg-slate-700 rounded-lg shadow-xl">
      <div class="hidden mb-2 font-medium text-center text-slate-500 border-b border-slate-600">
          <ul class="flex flex-wrap -mb-px">
              <li class="me-2">
                  <a href="#" class="inline-block p-2 text-white border-b-2 border-amber-500 active" aria-current="page">Most Wins</a>
              </li>
              <li class="me-2">
                  <a href="#" class="inline-block text-slate-400 p-2 border-b-2 border-transparent">Top Scores</a>
              </li>
              <li class="me-2">
                  <a href="#" class="inline-block text-slate-400 p-2 border-b-2 border-transparent">Total Points</a>
              </li>
          </ul>
      </div>

      <% @high_scores.each_with_index do |game, index| %>
        <!-- User row -->
        <div class="flex flex-row justify-between items-center">
          <!-- Left column -->
          <div class="flex flex-row gap-2 items-center">
            <div class="inline-block w-2 mr-1 text-slate-400 text-center"><%= index + 1 %></div>
            <div class="w-6 h-6 rounded-full bg-gradient-to-b shadow-lg <%= ['from-red-500 to-red-600', 'from-blue-500 to-blue-600', 'from-green-500 to-green-600', 'from-purple-500 to-purple-600', 'from-amber-500 to-amber-600', 'from-pink-500 to-pink-600', 'from-indigo-500 to-indigo-600'][index % 7] %> text-white flex items-center justify-center"><%= game.player1.email.first.upcase %></div>
            <div class="font-medium"><%= game.player1.email.titleize %></div>
          </div>
          <!-- Right column -->
          <div class=""><%= game.high_score %></div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Recent Games -->
  <div class="<%= @games.any? ? 'mb-4' : 'mb-2' %> flex flex-row justify-between items-center">
    <h1 class="text-xl font-medium dark:text-white">My Recent Games</h1>
  </div>
  <div id="games_list" class="mb-4 space-y-3">
    <% if @games.any? %>
      <% @games.each do |game| %>
        <%= render "games/game", game: game %>
      <% end %>
    <% else %>
      <div id="no_games_message" class="text-slate-500">You haven't played yet.</div>
    <% end %>
  </div>

  <!-- Admin -->
  <% if current_user.email == "derek" %>
    <h1 class="mb-2 text-xl font-medium dark:text-white">Admin Tools</h1>
    <div class="grid grid-cols-2 gap-2 w-full">
      <%= button_to "Generate Demos", games_path(type: :demo),
          class: "w-full btn btn-outline text-sm",
          data: { turbo_confirm: "Are you sure you want to generate demos?" } %>
      <%= button_to "View Player Stats", players_path,
          method: :get,
          class: "w-full btn btn-outline text-sm" %>
    </div>
  <% end %>

  <!-- Logout -->
  <%= button_to destroy_user_session_path, 
      method: :delete,
      form_class: "flex items-center gap-1.5",
      class: "w-full mt-4 mb-7 p-0 text-center text-slate-500 hover:text-white text-[.925rem] leading-none" do %>
    <i class="fa-solid fa-right-from-bracket"></i>
    <span class="text-slate-400 hover:text-white">Log Out</span>
  <% end %>
</div>